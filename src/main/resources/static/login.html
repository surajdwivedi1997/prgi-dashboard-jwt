<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PRGI Login / Signup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {margin:0;font-family:'Poppins',sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#f5576c 75%,#4facfe 100%);
      background-size:400% 400%;animation:bgFlow 20s ease infinite;}
    @keyframes bgFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .login-wrapper{display:flex;height:100vh;}
    .left-panel{flex:1;display:flex;justify-content:center;align-items:center;flex-direction:column;
      background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);}
    .left-panel img{max-width:250px;margin-bottom:20px;}
    .right-panel{flex:1;display:flex;justify-content:center;align-items:center;}
    .login-container{width:100%;max-width:400px;background:rgba(255,255,255,0.95);
      padding:40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.15);}
    .login-container h3{text-align:center;margin-bottom:25px;font-weight:700;}
    .form-control{margin-bottom:15px;border-radius:12px;}
    .btn-login{width:100%;background:linear-gradient(135deg,#667eea,#764ba2,#f093fb);
      color:#fff;border:none;padding:12px;border-radius:50px;font-weight:600;}
    .toggle-link{text-align:center;margin-top:15px;cursor:pointer;color:#667eea;font-size:14px;}
    .hidden{display:none;}
    .password-wrapper{position:relative;}
    .password-wrapper input{padding-right:40px;}
    .password-toggle{position:absolute;top:50%;right:12px;transform:translateY(-50%);
      cursor:pointer;color:#666;}
  </style>
</head>
<body>
<div class="login-wrapper">
  <!-- Left Panel -->
  <div class="left-panel">
    <img src="images/photo2.png" alt="PRGI Logo">
    <h1>PRGI</h1>
    <h2>Press Registrar General of India</h2>
  </div>

  <!-- Right Panel -->
  <div class="right-panel">
    <div class="login-container">

      <!-- Login Form -->
      <form id="loginForm">
        <h3>Portal Login</h3>
        <input type="email" id="loginEmail" class="form-control" placeholder="Email" required>

        <div class="password-wrapper">
          <input type="password" id="loginPassword" class="form-control" placeholder="Password" required>
          <span class="password-toggle" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</span>
        </div>

        <button type="submit" class="btn-login">Login</button>
        <p id="loginError" style="display:none;color:red;text-align:center;">Invalid credentials</p>
        <div class="toggle-link" onclick="toggleForms()">Don‚Äôt have an account? <b>Sign Up</b></div>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" class="hidden">
        <h3>Create Account</h3>
        <input type="text" id="signupName" class="form-control" placeholder="Full Name" required>
        <input type="email" id="signupEmail" class="form-control" placeholder="Email" required>

        <div class="password-wrapper">
          <input type="password" id="signupPassword" class="form-control" placeholder="Password" required>
          <span class="password-toggle" onclick="togglePassword('signupPassword', this)">üëÅÔ∏è</span>
        </div>

        <div class="password-wrapper">
          <input type="password" id="signupConfirmPassword" class="form-control" placeholder="Confirm Password" required>
          <span class="password-toggle" onclick="togglePassword('signupConfirmPassword', this)">üëÅÔ∏è</span>
        </div>

        <button type="submit" class="btn-login">Sign Up</button>
        <p id="signupError" style="display:none;color:red;text-align:center;">Signup failed</p>
        <div class="toggle-link" onclick="toggleForms()">Already have an account? <b>Login</b></div>
      </form>

    </div>
  </div>
</div>

<script>
  function toggleForms() {
    document.getElementById("loginForm").classList.toggle("hidden");
    document.getElementById("signupForm").classList.toggle("hidden");
  }

  function togglePassword(inputId, el) {
    const input = document.getElementById(inputId);
    if (input.type === "password") {
      input.type = "text";
      el.textContent = "üôà";
    } else {
      input.type = "password";
      el.textContent = "üëÅÔ∏è";
    }
  }

  // Login handler
  document.getElementById("loginForm").addEventListener("submit", async e => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value.trim();
    try {
      const res = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
      });
      if (!res.ok) throw new Error("Login failed");
      const data = await res.json();
      localStorage.setItem("jwtToken", data.token);
      localStorage.setItem("userRole", data.role || "ROLE_USER");
      localStorage.setItem("userName", data.name || "User");
      Swal.fire("‚úÖ Login Success", `Welcome ${data.name || data.role}`, "success");
      setTimeout(() => window.location.href="index.html", 1500);
    } catch(err) {
      document.getElementById("loginError").style.display = "block";
    }
  });

  // Signup handler
  document.getElementById("signupForm").addEventListener("submit", async e => {
    e.preventDefault();
    const name = document.getElementById("signupName").value.trim();
    const email = document.getElementById("signupEmail").value.trim();
    const password = document.getElementById("signupPassword").value.trim();
    const confirmPassword = document.getElementById("signupConfirmPassword").value.trim();
    if (password !== confirmPassword) {
      Swal.fire("‚ö†Ô∏è Password Mismatch", "Passwords do not match. Please try again.", "warning");
      return;
    }
    try {
      const res = await fetch("/regis", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name, email, password })
      });
      if (!res.ok) throw new Error("Signup failed");
      Swal.fire("üéâ Signup Success", "Now login with your credentials", "success");
      toggleForms();
    } catch(err) {
      document.getElementById("signupError").style.display = "block";
    }
  });
</script>
</body>
</html>
